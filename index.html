<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>javayhu test html</title>
</head>
<body style="padding-top:100px;padding-left:50px;">

<input id="input" type="text"/> <br/>
<button id="copy">复制内容到剪切板(document.execCommand)</button> <br/>
<div id="copy_result"></div>

<div style="height:100px;"></div>

<input id="output" type="text"/> <br/>
<button id="paste">粘贴剪切板的内容</button> <br/>
<div id="paste_result"></div>

<div style="height:100px;"></div>

<input id="nav_input" type="text"/> <br/>
<button id="nav_copy">复制剪切板的内容(navigator.clipboard)</button> <br/>
<div id="nav_copy_result"></div>

<script>
    // javayhu 复制是成功的，但是粘贴是失败的，暂不知为何
	const copyButton = document.querySelector('#copy');
	const copyText = document.querySelector('#input');
	const copyResult = document.querySelector('#copy_result');
	copyButton.addEventListener('click', function() {
		copyText.select();
		var result = document.execCommand("Copy");
		copyResult.innerText = "copy result:" + result;
	});

	const pasteButton = document.querySelector('#paste');
	const pasteText = document.querySelector('#output');
	const pasteResult = document.querySelector('#paste_result');
	pasteButton.addEventListener('click', function() {
		pasteText.focus();
		var result = document.execCommand("Paste");
		pasteResult.innerText = "paste result:" + result;
	});

	const navCopyButton = document.querySelector('#nav_copy');
	const navCopyText = document.querySelector('#nav_input');
	const navCopyResult = document.querySelector('#nav_copy_result');
	navCopyButton.addEventListener('click', function() {
		//navCopyText.select();

		// javayhu navigator.clipboard是有的，但是报错 Write permission denied
		navigator.clipboard.writeText('hello world');

        // javayhu 如果先判断权限又会报错 Uncaught TypeError: Cannot read property 'query' of undefined
		navigator.permissions.query({name: "clipboard-write", allowWithoutGesture: true}).then(result => {
          if (result.state == "granted" || result.state == "prompt") {
            console.log(result.state);
            navCopyResult.innerText = "copy result:" + result.state;
          }
        });
	});
</script>
</body>
</html>